<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificação de Membro - Liga Olímpica de Golfe</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * { font-family: 'Segoe UI', Roboto, sans-serif; }
        
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #1a5f2a 0%, #0d3d1a 100%);
        }
        
        .verification-card {
            max-width: 420px;
            width: 100%;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            background: white;
        }
        
        .card-header-custom {
            background: linear-gradient(135deg, #1a5f2a 0%, #2d8a3e 100%);
            padding: 25px 20px;
            text-align: center;
            border-bottom: 4px solid #d4af37;
        }
        
        .logo-verify {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 5px;
        }
        
        .logo-verify-text {
            color: #d4af37;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .header-subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 0.85rem;
        }
        
        .status-section {
            padding: 30px 25px;
            text-align: center;
        }
        
        .status-icon {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        
        .status-valid { background: linear-gradient(135deg, #28a745, #20c997); }
        .status-invalid { background: linear-gradient(135deg, #dc3545, #ff6b6b); }
        .status-warning { background: linear-gradient(135deg, #dc3545, #c82333); }
        
        .status-text { font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; }
        .status-text.valid { color: #28a745; }
        .status-text.invalid { color: #dc3545; }
        .status-text.warning { color: #dc3545; font-size: 1.2rem; }
        
        /* Etiqueta de Status da Carteirinha */
        .card-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }
        
        .card-status-badge.ativo {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }
        
        .card-status-badge.inativo {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.5);
        }
        
        .card-status-badge.piscante {
            animation: piscar-badge 0.6s ease-in-out infinite;
        }
        
        @keyframes piscar-badge {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(220, 53, 69, 0.5);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 6px 25px rgba(220, 53, 69, 0.8);
            }
        }
        
        /* Banner INATIVO Piscante */
        .inativo-banner-container {
            background: #dc3545;
            padding: 0;
            overflow: hidden;
        }
        
        .inativo-banner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 50%, #dc3545 100%);
            animation: piscar 0.8s ease-in-out infinite;
        }
        
        .inativo-banner span {
            font-size: 1.8rem;
            font-weight: 900;
            color: white;
            letter-spacing: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .inativo-banner i {
            font-size: 1.5rem;
            color: #ffcc00;
            animation: pulse-icon 0.8s ease-in-out infinite;
        }
        
        @keyframes piscar {
            0%, 100% { 
                background: linear-gradient(135deg, #dc3545 0%, #c82333 50%, #dc3545 100%);
                box-shadow: inset 0 0 30px rgba(0,0,0,0.3);
            }
            50% { 
                background: linear-gradient(135deg, #ff4757 0%, #ff6b6b 50%, #ff4757 100%);
                box-shadow: inset 0 0 50px rgba(255,255,255,0.2);
            }
        }
        
        @keyframes pulse-icon {
            0%, 100% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.2);
                opacity: 0.8;
            }
        }
        
        .player-photo {
            width: 110px;
            height: 130px;
            border-radius: 8px;
            object-fit: cover;
            border: 4px solid #d4af37;
            margin-bottom: 20px;
        }
        
        .player-photo-placeholder {
            width: 110px;
            height: 130px;
            border-radius: 8px;
            background: #e9ecef;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 4px solid #d4af37;
            margin-bottom: 20px;
        }
        
        .player-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a5f2a;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .player-code {
            display: inline-block;
            background: linear-gradient(135deg, #d4af37, #f4d03f);
            color: #1a1a1a;
            padding: 10px 30px;
            border-radius: 25px;
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 3px;
            margin-bottom: 20px;
        }
        
        .player-code-label {
            display: block;
            color: #6c757d;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: 600;
            color: white;
        }
        
        .badge-active { background: linear-gradient(135deg, #28a745, #20c997); }
        .badge-inactive { background: linear-gradient(135deg, #dc3545, #ff6b6b); }
        
        .verification-footer {
            background: #f8f9fa;
            padding: 20px;
            border-top: 1px solid #e9ecef;
            text-align: center;
        }
        
        .timer-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1a5f2a;
        }
        
        .countdown-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .countdown-progress {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 1s linear;
        }
        
        .error-alert {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
        }
    </style>
</head>
<body>
    
    <div class="verification-card">
        
        <!-- Header -->
        <div class="card-header-custom">
            <div class="logo-verify">
                <svg viewBox="0 0 50 50" width="40" height="40">
                    <circle cx="25" cy="12" r="5" fill="none" stroke="#d4af37" stroke-width="2"/>
                    <circle cx="15" cy="30" r="5" fill="none" stroke="#d4af37" stroke-width="2"/>
                    <circle cx="35" cy="30" r="5" fill="none" stroke="#d4af37" stroke-width="2"/>
                    <line x1="25" y1="17" x2="20" y2="25" stroke="#d4af37" stroke-width="2"/>
                    <line x1="25" y1="17" x2="30" y2="25" stroke="#d4af37" stroke-width="2"/>
                    <line x1="20" y1="30" x2="30" y2="30" stroke="#d4af37" stroke-width="2"/>
                </svg>
                <span class="logo-verify-text">Liga Olímpica de Golfe</span>
            </div>
            <div class="header-subtitle">Sistema de Verificação</div>
        </div>
        
        {% if valid %}
        
        <!-- BANNER PISCANTE INATIVO -->
        {% if not is_card_active %}
        <div class="inativo-banner-container">
            <div class="inativo-banner">
                <i class="fas fa-exclamation-triangle"></i>
                <span>INATIVO</span>
                <i class="fas fa-exclamation-triangle"></i>
            </div>
        </div>
        {% endif %}
        
        <!-- MEMBRO VERIFICADO -->
        <div class="status-section">
            
            {% if is_card_active %}
            <div class="status-icon status-valid">
                <i class="fas fa-check fa-3x text-white"></i>
            </div>
            <div class="status-text valid">MEMBRO VERIFICADO</div>
            <div class="card-status-badge ativo">
                <i class="fas fa-check-circle"></i> CARTEIRINHA ATIVA
            </div>
            {% else %}
            <div class="status-icon status-warning">
                <i class="fas fa-exclamation fa-3x text-white"></i>
            </div>
            <div class="status-text valid">MEMBRO VERIFICADO</div>
            <div class="card-status-badge inativo piscante">
                <i class="fas fa-times-circle"></i> CARTEIRINHA INATIVA
            </div>
            {% endif %}
            
            <!-- Foto -->
            {% if player and player['profile_photo'] %}
                <img src="{{ url_for('static', filename='profile_photos/' + player['profile_photo']) }}" 
                     alt="{{ player['name'] }}" 
                     class="player-photo">
            {% else %}
                <div class="player-photo-placeholder">
                    <i class="fas fa-user fa-3x text-secondary"></i>
                </div>
            {% endif %}
            
            <!-- Nome -->
            <div class="player-name">{{ player['name'] if player else 'N/A' }}</div>
            
            <!-- Código -->
            <div>
                <span class="player-code-label">CÓD. JOGADOR</span>
                <div class="player-code">{{ player['player_code'] if player else 'N/A' }}</div>
            </div>
            
            <!-- Status do Membro -->
            {% if player and player['active'] %}
                <span class="status-badge badge-active mb-3">
                    <i class="fas fa-check-circle"></i> MEMBRO ATIVO
                </span>
            {% else %}
                <span class="status-badge badge-inactive mb-3">
                    <i class="fas fa-times-circle"></i> INATIVO
                </span>
            {% endif %}
            
            <!-- ALERTA DE CARTEIRINHA INATIVA -->
            {% if not is_card_active %}
            <div class="alert alert-danger mt-3 mb-0 text-start" style="border-radius: 12px; border-left: 5px solid #dc3545;">
                <div class="d-flex align-items-start">
                    <i class="fas fa-exclamation-triangle fa-2x text-danger me-3 mt-1"></i>
                    <div>
                        <h6 class="alert-heading mb-1 fw-bold">
                            <i class="fas fa-ban me-1"></i> CARTEIRINHA INATIVA
                        </h6>
                        <p class="mb-1 small">
                            Este membro <strong>não jogou</strong> nos últimos 30 dias.
                        </p>
                        {% if last_game_date %}
                        <small class="text-muted">
                            <i class="fas fa-calendar-alt me-1"></i> Último jogo: {{ last_game_date }}
                        </small>
                        {% else %}
                        <small class="text-muted">
                            <i class="fas fa-calendar-times me-1"></i> Nenhum jogo registrado
                        </small>
                        {% endif %}
                        <hr class="my-2">
                        <small class="fw-bold text-danger">
                            <i class="fas fa-info-circle me-1"></i>
                            Os benefícios do clube podem não se aplicar.
                        </small>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Carteirinha Ativa -->
            <div class="alert alert-success mt-3 mb-0 text-center" style="border-radius: 12px;">
                <i class="fas fa-golf-ball me-2"></i>
                <strong>Carteirinha ativa</strong> - Jogou nos últimos 30 dias
            </div>
            {% endif %}
            
        </div>
        
        <!-- Footer com Timer -->
        <div class="verification-footer">
            <div class="text-muted mb-2">
                <i class="fas fa-clock me-1"></i>
                Verificação válida por mais:
            </div>
            <div class="timer-value" id="countdown">
                {{ '%02d' % minutes_remaining }}:{{ '%02d' % seconds_remaining }}
            </div>
            <div class="countdown-bar">
                <div class="countdown-progress" id="progressBar" style="width: 100%;"></div>
            </div>
            <div class="text-muted small mt-2">
                <i class="fas fa-shield-alt me-1"></i>
                Verificado em {{ verified_at.strftime('%d/%m/%Y às %H:%M:%S') }}
            </div>
        </div>
        
        <script>
            var totalSeconds = {{ minutes_remaining * 60 + seconds_remaining }};
            var initialSeconds = totalSeconds > 0 ? totalSeconds : 600;
            
            function updateCountdown() {
                if (totalSeconds <= 0) {
                    document.getElementById('countdown').textContent = 'EXPIRADO';
                    document.getElementById('progressBar').style.width = '0%';
                    document.getElementById('progressBar').style.background = '#dc3545';
                    return;
                }
                
                var minutes = Math.floor(totalSeconds / 60);
                var seconds = totalSeconds % 60;
                
                document.getElementById('countdown').textContent = 
                    (minutes < 10 ? '0' : '') + minutes + ':' + (seconds < 10 ? '0' : '') + seconds;
                
                var percentage = (totalSeconds / initialSeconds) * 100;
                document.getElementById('progressBar').style.width = percentage + '%';
                
                if (percentage < 20) {
                    document.getElementById('progressBar').style.background = '#dc3545';
                } else if (percentage < 50) {
                    document.getElementById('progressBar').style.background = '#ffc107';
                }
                
                totalSeconds--;
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        </script>
        
        {% else %}
        <!-- TOKEN INVÁLIDO -->
        <div class="status-section">
            
            <div class="status-icon status-invalid">
                <i class="fas fa-times fa-3x text-white"></i>
            </div>
            
            <div class="status-text invalid">VERIFICAÇÃO INVÁLIDA</div>
            
            <p class="text-muted">
                {{ error if error else 'O código de verificação é inválido ou expirou.' }}
            </p>
            
            <div class="error-alert">
                <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                <strong>Atenção:</strong> Peça ao membro para abrir a carteirinha digital e gerar um novo QR Code.
            </div>
            
        </div>
        
        <div class="verification-footer">
            <div class="text-muted small">
                <i class="fas fa-clock me-1"></i>
                Tentativa em {{ verified_at.strftime('%d/%m/%Y às %H:%M:%S') if verified_at else 'agora' }}
            </div>
        </div>
        
        {% endif %}
        
    </div>
    
</body>
</html>