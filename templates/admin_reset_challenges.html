{% extends 'base.html' %}

{% block title %}Resetar Desafios - Admin{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Iniciar Nova Etapa do Ranking
                    </h4>
                </div>
                <div class="card-body">
                    
                    <div class="alert alert-warning">
                        <h5><i class="fas fa-warning me-2"></i>Atenção!</h5>
                        <p class="mb-0">Esta ação irá <strong>arquivar todos os desafios e o histórico do ranking</strong> para iniciar uma nova etapa. Os jogadores manterão suas posições atuais.</p>
                    </div>
                    
                    <!-- Estatísticas atuais -->
                    <div class="card mb-3">
                        <div class="card-header bg-secondary text-white py-2">
                            <strong><i class="fas fa-flag me-2"></i>Desafios que serão arquivados:</strong>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col">
                                    <h3 class="text-primary">{{ stats.total or 0 }}</h3>
                                    <small class="text-muted">Total</small>
                                </div>
                                <div class="col">
                                    <h3 class="text-warning">{{ stats.pending or 0 }}</h3>
                                    <small class="text-muted">Pendentes</small>
                                </div>
                                <div class="col">
                                    <h3 class="text-info">{{ stats.accepted or 0 }}</h3>
                                    <small class="text-muted">Aceitos</small>
                                </div>
                                <div class="col">
                                    <h3 class="text-success">{{ stats.completed or 0 }}</h3>
                                    <small class="text-muted">Concluídos</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Histórico do ranking -->
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white py-2">
                            <strong><i class="fas fa-history me-2"></i>Histórico do ranking que será arquivado:</strong>
                        </div>
                        <div class="card-body text-center">
                            <h3 class="text-info">{{ history_count or 0 }}</h3>
                            <small class="text-muted">Registros de posições</small>
                        </div>
                    </div>
                    
                    <!-- Formulário de confirmação -->
                    <form method="POST" action="{{ url_for('reset_challenges') }}">
                        
                        <div class="mb-3">
                            <label for="etapa_name" class="form-label">
                                <i class="fas fa-tag me-1"></i> Nome da etapa (opcional):
                            </label>
                            <input type="text" class="form-control" id="etapa_name" name="etapa_name" 
                                   placeholder="Ex: Etapa 1 - Verão 2025" 
                                   value="Etapa até {{ now().strftime('%d/%m/%Y') }}">
                            <small class="text-muted">Este nome será usado para identificar os dados arquivados.</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="confirm_text" class="form-label">
                                <i class="fas fa-keyboard me-1"></i> Para confirmar, digite <strong class="text-danger">RESETAR</strong>:
                            </label>
                            <input type="text" class="form-control" id="confirm_text" name="confirm_text" 
                                   placeholder="Digite RESETAR" required autocomplete="off">
                        </div>
                        
                        <div class="d-flex gap-2">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-danger flex-grow-1">
                                <i class="fas fa-refresh me-1"></i> Confirmar e Iniciar Nova Etapa
                            </button>
                        </div>
                        
                    </form>
                    
                </div>
            </div>
            
            <!-- Informações adicionais -->
            <div class="card mt-3">
                <div class="card-body">
                    <h6><i class="fas fa-info-circle text-info me-2"></i>O que acontece ao resetar:</h6>
                    <ul class="mb-0 small">
                        <li>Todos os <strong>desafios</strong> são arquivados na tabela <code>challenges_history</code></li>
                        <li>Todo o <strong>histórico de posições</strong> é arquivado na tabela <code>ranking_history_archive</code></li>
                        <li>Os jogadores <strong>mantêm suas posições atuais</strong></li>
                        <li>Novos desafios podem ser criados imediatamente</li>
                        <li>O histórico pode ser consultado posteriormente</li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>
</div>
{% endblock %}